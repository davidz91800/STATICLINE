<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Justificatif de Calcul de Largage DZ</title>
    
    <!-- PWA additions -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3b82f6">

    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Ajout de la police Stardos Stencil pour l'en-tête -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Stardos+Stencil:wght@700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="container">
        <header class="header-immersive">
            <!-- Logo PNG -->
            <img src="logo.png" alt="Logo Static Line" class="logo-icon">
            <!-- Titre stylisé -->
            <h1>STATIC LINE</h1>
            <!-- Informations de création sur deux lignes -->
            <div class="header-credits">
                <p>Créé par le <strong>CDT ZEMMOUR David</strong></p>
                <p>Version 1.0 (08/06/2025)</p>
            </div>
        </header>

        <!-- CARD 0: Météo -->
        <div class="card">
            <div class="card-header collapsed">
                <span class="step-number" style="background-color: #0ea5e9;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20"><path d="M11.983 1.904a3.003 3.003 0 00-5.717 2.223A4.502 4.502 0 005.5 10.5H7v-1H5.5a3.502 3.502 0 013.42-3.49A3.001 3.001 0 0012 3.5a2.5 2.5 0 012.5 2.5A2.994 2.994 0 0112.5 9H11v1h1.5a3.992 3.992 0 003.983-4.096A3.001 3.001 0 0011.983 1.904z"></path><path d="M9.25 11.25a.75.75 0 01.75.75v3.69l1.22-1.22a.75.75 0 111.06 1.06l-2.5 2.5a.75.75 0 01-1.06 0l-2.5-2.5a.75.75 0 111.06-1.06l1.22 1.22v-3.69a.75.75 0 01.75-.75z"></path></svg>
                </span>
                <h2>Récupération Météo</h2>
                <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"></path></svg>
            </div>
            <div class="card-content">
                <div class="input-group"><label for="coords">Coordonnées Géographiques du Point d'Impact</label><input type="text" id="coords" placeholder="ex: N48°51.46 E002°21.11" value="N48°51.46 E002°21.11"></div>
                <div class="grid" style="gap: 1rem; margin-top: 1rem;">
                    <div class="input-group"><label for="forecast-date">Date</label><input type="date" id="forecast-date"></div>
                    <div class="input-group"><label for="forecast-time">Heure (UTC)</label><input type="time" id="forecast-time"></div>
                </div>
                <button id="fetch-weather-btn" class="button" style="margin-top:1rem;">Obtenir et Appliquer la Météo</button>
                <div id="weather-results" style="margin-top:1.5rem; display:none;"><h4>Données Météo Récupérées</h4><div id="weather-results-content"></div></div>
            </div>
        </div>
        
        <!-- CARD 1: Données & Paramètres -->
        <div class="card">
            <div class="card-header collapsed" id="params-card-header">
                <span class="step-number">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20"><path d="M3 3.75A.75.75 0 0 1 3.75 3h12.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 3.75ZM3 7.75A.75.75 0 0 1 3.75 7h12.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 7.75ZM3 11.75A.75.75 0 0 1 3.75 11h12.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 11.75ZM3 15.75A.75.75 0 0 1 3.75 15h12.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 15.75Z"></path></svg>
                </span>
                <h2>Données & Paramètres</h2>
                <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" /></svg>
            </div>
            <div class="card-content">
                <div class="grid">
                    <div class="input-group"><label for="total-personnel">Total Paras à Larguer</label><input type="number" id="total-personnel" value="90"></div>
                    <div class="input-group">
                        <label for="jumper-mass">Masse parachutiste</label>
                        <div class="input-unit-container" data-unit="kg"><input type="number" id="jumper-mass" value="120"></div>
                    </div>
                    <div class="calculated-field">
                        <label>Masse Totale</label>
                        <strong id="total-mass-display">-- kg / -- lbs</strong>
                    </div>
                    <div class="input-group"><label for="jumper-type">Type Paras</label><select id="jumper-type"><option value="NON-EQUIPPED">Non-Équipés</option><option value="EQUIPPED" selected>Équipés</option></select></div>
                    <div class="input-group"><label for="aircraft-type">Type Aéronef</label><select id="aircraft-type"><option value="C130J-30" selected>C-130J-30</option><option value="KC130J">KC-130J</option></select></div>
                    <div class="input-group"><label for="center-seats">Version centrale</label><select id="center-seats"><option value="true" selected>Oui</option><option value="false">Non</option></select></div>
                    <div class="input-group"><label for="time-of-day">Conditions</label><select id="time-of-day"><option value="day" selected>Jour</option><option value="night">Nuit</option></select></div>
                    <div class="input-group"><label for="security-level">Niveau de Sécurité</label><select id="security-level"><option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option></select></div>
                    <div class="input-group"><label for="parachute-type">Type Parachute</label><select id="parachute-type"><option value="EPI">EPI</option><option value="EPC" selected>EPC</option></select></div>
                    <div class="input-group"><label for="exit-type">Exit</label><select id="exit-type"><option value="doors" selected>Paratroop doors</option><option value="ramp">Ramp</option></select></div>
                    <div class="input-group"><label for="visual-refs">Réf. Visuelles</label><select id="visual-refs"><option value="true" selected>Oui</option><option value="false">Non</option></select></div>
                    <div class="input-group dual-input-group">
                        <label>Longueur DZ (L)</label>
                        <div class="dual-input-container">
                            <div class="input-unit-container" data-unit="m"><input type="number" id="dz-length-m" value="2000"></div>
                            <div class="input-unit-container" data-unit="yds"><input type="number" id="dz-length-yds"></div>
                        </div>
                    </div>
                    <div class="input-group dual-input-group">
                        <label>Largeur DZ (l)</label>
                        <div class="dual-input-container">
                            <div class="input-unit-container" data-unit="m"><input type="number" id="dz-width-m" value="500"></div>
                            <div class="input-unit-container" data-unit="yds"><input type="number" id="dz-width-yds"></div>
                        </div>
                    </div>
                    <div class="input-group dual-input-group">
                        <label>Hauteur Largage (H)</label>
                        <div class="dual-input-container">
                            <div class="input-unit-container" data-unit="m"><input type="number" id="drop-height-m" value="300"></div>
                            <div class="input-unit-container" data-unit="ft"><input type="number" id="drop-height-ft"></div>
                        </div>
                    </div>
                    <div class="input-group dual-input-group">
                        <label>Altitude DZ (Zt)</label>
                        <div class="dual-input-container">
                            <div class="input-unit-container" data-unit="m"><input type="number" id="dz-altitude-m" value="152"></div>
                            <div class="input-unit-container" data-unit="ft"><input type="number" id="dz-altitude-ft"></div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="drop-axis">Axe Largage</label>
                        <div class="input-unit-container" data-unit="°"><input type="number" id="drop-axis" value="45"></div>
                    </div>
                    
                    <div class="input-group">
                        <label>Vent à l'altitude de largage</label>
                        <div class="wind-group">
                             <div class="input-unit-container" data-unit="°"><input type="number" id="wind-direction" value="135"></div>
                             <span>/</span>
                             <div class="input-unit-container" data-unit="kt"><input type="number" id="wind-speed" value="15"></div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Vent au sol</label>
                        <div class="wind-group">
                             <div class="input-unit-container" data-unit="°"><input type="number" id="ground-wind-direction" value="140"></div>
                             <span>/</span>
                             <div class="input-unit-container" data-unit="kt"><input type="number" id="ground-wind-speed" value="10"></div>
                        </div>
                    </div>
                    
                    <div class="input-group"><label for="cadence">Cadence (paras/sec)</label><input type="number" id="cadence" value="1" step="0.1"></div>
                </div>
            </div>
        </div>

        <!-- Validation Panel -->
        <div id="global-alerts-container"></div>
        
        <!-- Synthèse Card (now collapsible) -->
        <div class="card">
             <div class="card-header collapsed" id="synthesis-header">
                <span class="step-number" id="synthesis-icon">✓</span>
                <h2>Synthèse</h2>
                <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" /></svg>
            </div>
            <div class="card-content">
                <div class="final-results-grid">
                    <div class="result-box final">
                        <span id="required-passes">--</span>
                        <label>Passes Requises</label>
                        <div class="final-details">Pour larguer <strong id="total-personnel-recap-passes">--</strong> paras avec une capacité de <strong id="max-paras-per-pass">--</strong> paras/passe.</div>
                    </div>
                    <div class="result-box final" id="takeoffs-box" style="display: none;">
                        <span id="required-takeoffs">--</span>
                        <label>Décollages Requis</label>
                        <div class="final-details">Capacité soute : <strong id="aircraft-capacity-recap">--</strong> paras.</div>
                    </div>
                    <div class="result-box wind-limit-box" id="wind-limit-box" style="display: none;">
                        <span id="wind-limit-value">-- m/s</span>
                        <label>Limitation Vent</label>
                        <div class="final-details" id="wind-limit-reason">Raison du calcul...</div>
                    </div>
                    <div class="result-box params-box" id="parachute-params-box" style="display: none;">
                        <label>Paramètres de Voile</label>
                        <div class="params-mass-recap" id="params-mass-recap-display"></div>
                        <div class="params-content" id="parachute-params-content">
                            <!-- Le contenu sera généré par JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Merged Calculation Details Card -->
        <div class="card">
            <div class="card-header collapsed">
                <span class="step-number">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20"><path d="M10 2.5a.75.75 0 0 1 .75.75v.25h3.5a.75.75 0 0 1 0 1.5h-1.5v5.5a.75.75 0 0 1-1.5 0v-5.5h-1.5a.75.75 0 0 1 0-1.5h3.5v-.25a.75.75 0 0 1-.75-.75ZM2 5.75A.75.75 0 0 1 2.75 5h4.5a.75.75 0 0 1 0 1.5h-4.5A.75.75 0 0 1 2 5.75Zm1.25 4a.75.75 0 0 0 0 1.5h2.5a.75.75 0 0 0 0-1.5h-2.5Z"></path><path fill-rule="evenodd" d="M2 3.5A1.5 1.5 0 0 1 3.5 2h13A1.5 1.5 0 0 1 18 3.5v13a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 2 16.5v-13Zm1.5-.5a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-13a.5.5 0 0 0-.5-.5h-13Z" clip-rule="evenodd"></path></svg>
                </span>
                <h2>Détail des Calculs</h2>
                <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" /></svg>
            </div>
            <div class="card-content">
                <!-- Vitesse Sol Section -->
                <h4 class="calculation-subtitle">Calcul Vitesse Sol</h4>
                <div class="calculation-step">
                    <code class="formula">V = TAS - Comp. Vent Long.</code>
                    <div class="formula-breakdown">
                        <div class="detail-item"><span>Vitesse Indiquée (IAS)</span><strong>125 kt</strong></div>
                        <div class="detail-item"><span>Altitude Densité</span><strong id="density-altitude-detail">-- ft</strong></div>
                        <div class="detail-item"><span>Vitesse Vraie (TAS)</span><strong id="tas-detail">-- kt</strong></div>
                        <div class="detail-item"><span>Composante Longitudinale</span><strong id="long-wind-detail">-- kt</strong></div>
                    </div>
                     <div class="detail-item"><span><strong>Vitesse Sol (V)</strong></span><strong id="ground-speed-detail">-- kt / -- m/s</strong></div>
                </div>

                <!-- Capacité DZ Section -->
                <h4 class="calculation-subtitle">Capacité Théorique DZ</h4>
                <div class="calculation-step">
                    <code class="formula" id="dz-capacity-formula">P = [(L - H) / V] * C + 1</code>
                    <div class="formula-breakdown">
                        <div class="detail-item"><span>Longueur Zone (L)</span><strong id="total-length-detail">-- m</strong></div>
                        <div class="detail-item"><span>Hauteur de largage (H)</span><strong id="h-in-formula-detail">-- m</strong></div>
                        <div class="detail-item"><span>Vitesse Sol (V)</span><strong id="v-in-formula-detail">-- m/s</strong></div>
                        <div class="detail-item"><span>Cadence (C)</span><strong id="c-in-formula-detail">-- paras/s</strong></div>
                    </div>
                    <div class="detail-item"><span><strong>Paras / Porte (Théorique)</strong></span><strong id="paras-per-door-detail">--</strong></div>
                 </div>

                <!-- Contraintes Section -->
                <h4 class="calculation-subtitle">Contraintes DZ vs AIRCRAFT</h4>
                <div class="calculation-step">
                     <div class="formula-breakdown">
                        <div class="detail-item"><span>Capacité DZ</span><strong id="theoretical-capacity-detail">-- paras</strong></div>
                        <div class="detail-item"><span>Capacité Soute</span><strong id="aircraft-capacity-detail">-- paras</strong></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Accordéons d'information -->
        <div class="card card-info-error">
            <div class="card-header collapsed">
                <span class="step-number alert-icon-error">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
                </span>
                <h2>Détail des Alertes Rouges (Erreurs Critiques)</h2>
                <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"></path></svg>
            </div>
            <div class="card-content">
                <p class="info-paragraph"><strong>Signification :</strong> Indique une condition NON-RÉGLEMENTAIRE. Le largage est proscrit tant que le problème n'est pas corrigé.</p>
                <ul class="info-content-list">
                    <li><strong>Hauteur de largage trop basse/haute :</strong> La hauteur (H) est hors des limites autorisées pour la combinaison "Parachute / Niveau de sécurité".</li>
                    <li><strong>Largeur DZ insuffisante (avec réf. visuelles) :</strong> La largeur (l) est inférieure soit à la hauteur (<code>l < H</code>), soit au minimum de 300m.</li>
                    <li><strong>Largeur DZ insuffisante (sans réf. visuelles) :</strong> La largeur (l) est inférieure soit à <code>H + 100m</code>, soit au minimum de 400m.</li>
                    <li><strong>Vent au sol trop élevé :</strong> Le vent au sol dépasse la limite calculée pour les conditions actuelles.</li>
                    <li><strong>Dépassement des composantes de vent :</strong> Cas spécifique (EPC, N3, sans réf.) où le vent de face/travers dépasse 5 m/s.</li>
                    <li><strong>Conditions non autorisées :</strong> La combinaison de paramètres n'est pas prévue par la réglementation (ex: largage de nuit à 150m).</li>
                </ul>
            </div>
        </div>

        <div class="card card-info-warning">
            <div class="card-header collapsed">
                <span class="step-number alert-icon-warning">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
                </span>
                <h2>Détail des Alertes Jaunes (Avertissements)</h2>
                <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"></path></svg>
            </div>
            <div class="card-content">
                <p class="info-paragraph"><strong>Signification :</strong> Indique une contrainte opérationnelle majeure. Le largage reste possible mais avec vigilance.</p>
                <ul class="info-content-list">
                    <li><strong>Largage par une seule porte :</strong> Déclenché pour un largage EPC à moins de 300m. La capacité par passe est automatiquement ajustée.</li>
                </ul>
            </div>
        </div>

        <div class="card card-info-info">
            <div class="card-header collapsed">
                <span class="step-number alert-icon-info">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-7-4a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM9 9a.75.75 0 0 0 0 1.5h.253a.25.25 0 0 1 .244.304l-.459 2.066A1.75 1.75 0 0 0 10.747 15h.506a.75.75 0 0 0 0-1.5h-.506a.25.25 0 0 1-.244-.304l.459-2.066A1.75 1.75 0 0 0 9.253 9H9Z" clip-rule="evenodd" /></svg>
                </span>
                <h2>Détail des Messages Bleus (Informations)</h2>
                <svg class="chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"></path></svg>
            </div>
            <div class="card-content">
                 <p class="info-paragraph"><strong>Signification :</strong> Fournit un contexte ou un rappel réglementaire utile pour la planification.</p>
                <ul class="info-content-list">
                    <li><strong>"Wind Dummy" obligatoire :</strong> Rappel affiché lorsque le niveau de sécurité est réglé sur 1.</li>
                    <li><strong>Capacité limitée par la soute :</strong> Indique que la DZ peut accueillir plus de paras que l'avion ne peut en emporter. Le calcul est plafonné par la capacité de l'avion.</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="script.js" defer></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('Service Worker enregistré avec succès:', registration);
                    })
                    .catch(error => {
                        console.log('Erreur lors de l'enregistrement du Service Worker:', error);
                    });
            });
        }
    </script>
</body>
</html>